<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="icon" type="image/svg+xml" href="/slimfaas.svg" data-next-head=""/><title data-next-head="">SlimFaas : The slimmest and simplest Function As A Service</title><meta property="og:title" content="SlimFaas : The slimmest and simplest Function As A Service" data-next-head=""/><meta property="og:description" content="Deploy functions effortlessly with SlimFaas, the ultra-light FaaS platform." data-next-head=""/><meta property="og:image" content="https://github.com/SlimPlanet/SlimFaas/blob/main/documentation/SlimFaas.png?raw=true" data-next-head=""/><meta property="og:url" content="https://github.com/SlimPlanet/SlimFaas" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><meta name="twitter:title" content="SlimFaas : The slimmest and simplest Function As A Service" data-next-head=""/><meta name="twitter:description" content="Deploy functions effortlessly with SlimFaas, the ultra-light FaaS platform." data-next-head=""/><meta name="twitter:image" content="https://github.com/SlimPlanet/SlimFaas/blob/main/documentation/SlimFaas.png?raw=true" data-next-head=""/><link rel="preload" href="/_next/static/chunks/f79d8dc54c1f1d48.css" as="style"/><script id="consent-mode-default" data-nscript="beforeInteractive">
                  window.dataLayer = window.dataLayer || [];
                  function gtag(){dataLayer.push(arguments);}
                  gtag('consent', 'default', {
                    analytics_storage: 'denied',
                    ad_storage: 'denied',
                    ad_user_data: 'denied',
                    ad_personalization: 'denied',
                    wait_for_update: 500
                  });
                </script><link rel="stylesheet" href="/_next/static/chunks/f79d8dc54c1f1d48.css" data-n-g=""/><noscript data-n-css=""></noscript><script src="/_next/static/chunks/c81b168a3a0921e5.js" defer=""></script><script src="/_next/static/chunks/c692ace36a839e21.js" defer=""></script><script src="/_next/static/chunks/c03b620c110207e6.js" defer=""></script><script src="/_next/static/chunks/31ff616d2f5120e5.js" defer=""></script><script src="/_next/static/chunks/turbopack-24e9b88111e1a012.js" defer=""></script><script src="/_next/static/chunks/e490415fb905bee5.js" defer=""></script><script src="/_next/static/chunks/74ec02afeb306559.js" defer=""></script><script src="/_next/static/chunks/turbopack-56b83c113fa69efd.js" defer=""></script><script src="/_next/static/d93zpedczAei54D1TFYtc/_ssgManifest.js" defer=""></script><script src="/_next/static/d93zpedczAei54D1TFYtc/_buildManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PKM3T5QT" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><div class="layout"><nav class="layout__navbar navbar"><div class="navbar__left"><a class="navbar__logo-link" href="/"><img alt="Logo" loading="lazy" width="64" height="64" decoding="async" data-nimg="1" class="navbar__logo" style="color:transparent" src="https://github.com/cncf/artwork/blob/main/projects/slimfaas/icon/white/slimfaas-icon-white.svg?raw=true"/></a><button class="navbar__toggle " aria-label="Toggle menu" aria-expanded="false" aria-controls="navbar-main-list" type="button"><span class="navbar__toggle-bar"></span><span class="navbar__toggle-bar"></span><span class="navbar__toggle-bar"></span></button><ul id="navbar-main-list" class="navbar__list "><li class="navbar__item"><a class="navbar__link" href="/">Home</a></li><li class="navbar__item"><a class="navbar__link" href="/get-started">Get Started</a></li><li class="navbar__item navbar__item--has-submenu "><button type="button" class="navbar__link navbar__link--submenu-toggle" aria-haspopup="true" aria-expanded="false" aria-controls="navbar-functions-submenu">Functions<span class="navbar__submenu-icon" aria-hidden="true">‚ñæ</span></button><ul id="navbar-functions-submenu" class="navbar__submenu "><li class="navbar__submenu-item"><a class="navbar__submenu-link" href="/functions">Functions</a></li><li class="navbar__submenu-item"><a class="navbar__submenu-link" href="/events">Events</a></li><li class="navbar__submenu-item"><a class="navbar__submenu-link" href="/jobs">Jobs</a></li><li class="navbar__submenu-item"><a class="navbar__submenu-link" href="/opentelemetry">Open Telemetry</a></li></ul></li><li class="navbar__item navbar__item--has-submenu "><button type="button" class="navbar__link navbar__link--submenu-toggle" aria-haspopup="true" aria-expanded="false" aria-controls="navbar-scale-submenu">Scale<span class="navbar__submenu-icon" aria-hidden="true">‚ñæ</span></button><ul id="navbar-scale-submenu" class="navbar__submenu "><li class="navbar__submenu-item"><a class="navbar__submenu-link" href="/autoscaling">Autoscaling</a></li><li class="navbar__submenu-item"><a class="navbar__submenu-link" href="/kafka">Kafka Connector</a></li><li class="navbar__submenu-item"><a class="navbar__submenu-link" href="/planet-saver">PlanetSaver</a></li></ul></li><li class="navbar__item navbar__item--has-submenu "><button type="button" class="navbar__link navbar__link--submenu-toggle" aria-haspopup="true" aria-expanded="false" aria-controls="navbar-data-submenu">Data<span class="navbar__submenu-icon" aria-hidden="true">‚ñæ</span></button><ul id="navbar-data-submenu" class="navbar__submenu "><li class="navbar__submenu-item"><a class="navbar__submenu-link" href="/data-files">Files</a></li><li class="navbar__submenu-item"><a class="navbar__submenu-link" href="/data-sets">Sets</a></li></ul></li><li class="navbar__item"><a class="navbar__link" href="/how-it-works">How it works</a></li><li class="navbar__item"><a class="navbar__link" href="/mcp">MCP</a></li></ul></div><a href="https://github.com/SlimPlanet/SlimFaas" class="navbar__github" target="_blank" rel="noopener noreferrer"><svg class="navbar__github-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 0.296875C5.37256 0.296875 0 5.66943 0 12.2969C0 17.6394 3.43848 22.146 8.20703 23.7744C8.80762 23.8848 9.02344 23.5156 9.02344 23.1982C9.02344 22.9277 9.0127 21.9941 9.00781 20.9102C5.67188 21.6572 4.96875 19.1738 4.96875 19.1738C4.4375 17.8193 3.64062 17.498 3.64062 17.498C2.54785 16.7939 3.72461 16.8105 3.72461 16.8105C4.93359 16.8896 5.55469 18.0332 5.55469 18.0332C6.625 19.9316 8.37207 19.4082 9.0625 19.1113C9.16797 18.3301 9.45898 17.7939 9.78906 17.4863C7.14062 17.1807 4.34766 16.1582 4.34766 11.6084C4.34766 10.3223 4.8125 9.22852 5.58984 8.36133C5.46094 8.05566 5.04883 6.8418 5.71094 5.16406C5.71094 5.16406 6.72559 4.83008 9.00488 6.44336C9.97852 6.18164 11.0078 6.05078 12.0371 6.04688C13.0664 6.05078 14.0957 6.18164 15.0693 6.44336C17.3486 4.83008 18.3623 5.16406 18.3623 5.16406C19.0244 6.8418 18.6123 8.05566 18.4824 8.36133C19.2598 9.22852 19.7246 10.3223 19.7246 11.6084C19.7246 16.168 16.9277 17.1768 14.2734 17.4746C14.6914 17.8525 15.0547 18.5742 15.0547 19.7012C15.0547 21.3076 15.0391 22.6631 15.0391 23.1982C15.0391 23.5156 15.2559 23.8896 15.8613 23.7744C20.625 22.146 24.0664 17.6394 24.0664 12.2969C24 5.66943 18.6274 0.296875 12 0.296875Z"></path></svg></a></nav><main class="layout__content"><div><div><html><head></head><body><h1>SlimFaas Kafka Connector <a href="https://hub.docker.com/r/axaguildev/slimfaas-kafka/builds"><img src="https://img.shields.io/docker/pulls/axaguildev/slimfaas-kafka.svg?label=docker+pull+slimfaas-kafka" alt="Docker SlimFaas"></a> <a href="https://hub.docker.com/r/axaguildev/slimfaas/builds"><img src="https://img.shields.io/docker/image-size/axaguildev/slimfaas-kafka?label=image+size+slimfaas-kafka" alt="Docker Image Size"></a> <a href="https://hub.docker.com/r/axaguildev/slimfaas-kafka/builds"><img src="https://img.shields.io/docker/v/axaguildev/slimfaas-kafka?sort=semver&amp;label=latest+version+slimfaas-kafka" alt="Docker Image Version"></a> <a href="https://artifacthub.io/packages/search?repo=slimfaas-kafka"><img src="https://img.shields.io/endpoint?url=https://artifacthub.io/badge/repository/slimfaas-kafka" alt="Artifact Hub"></a></h1>
<p>SlimFaas-Kafka is a lightweight micro‚Äëservice designed to <strong>monitor Kafka topics</strong> and automatically <strong>wake up SlimFaas functions</strong> when messages arrive or when recent Kafka activity indicates the function should stay awake.
It enables full event‚Äëdriven autoscaling of SlimFaas functions based on Kafka queues ‚Äî without consuming the messages itself.</p>
<hr>
<h2>üöÄ Overview</h2>
<p>SlimFaas-Kafka acts as a <strong>sidecar orchestration component</strong> that:</p>
<ol>
<li><strong>Watches Kafka topics</strong> for:
<ul>
<li>Pending messages (lag)</li>
<li>Recent consumption activity (progress in committed offsets)</li>
</ul>
</li>
<li><strong>Decides when a SlimFaas function should be started or kept alive</strong></li>
<li><strong>Triggers SlimFaas wake‚Äëup API</strong> to scale functions from 0 ‚Üí N pods</li>
</ol>
<p>SlimFaasKafka <strong>never consumes messages</strong> from your topics.
It only queries:</p>
<ul>
<li>high watermark offsets (latest message index per partition)</li>
<li>committed consumer group offsets (only if Kafka ACLs allow it)</li>
</ul>
<p>This means your message streams remain <strong>untouched</strong> and your existing consumers operate normally.</p>
<hr>
<h2>üèó Architecture</h2>
<p>Below is the logical architecture:</p>
<pre><code class="hljs">Kafka Topics  ‚Üí  SlimFaasKafka  ‚Üí  SlimFaas Orchestrator  ‚Üí  <span class="hljs-keyword">Function</span> <span class="hljs-title">Pods</span>
                    ‚Üë   ‚Üì                         ‚Üë
       Metadata &amp; Offsets   Wake‚Äëup events        |
</code></pre>
<h3>Components</h3>
<div class="table-scroll" role="region" aria-label="Scrollable table" tabindex="0"><table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SlimFaasKafka</strong></td>
<td>Monitors Kafka lag &amp; activity; sends wake signals</td>
</tr>
<tr>
<td><strong>Kafka Broker</strong></td>
<td>Holds the messages and consumer groups</td>
</tr>
<tr>
<td><strong>SlimFaas</strong></td>
<td>Manages function replicas and performs the actual autoscaling</td>
</tr>
<tr>
<td><strong>Function Pods</strong></td>
<td>Stateless workers that process Kafka messages</td>
</tr>
</tbody>
</table></div>
<p>SlimFaasKafka integrates with SlimFaas by calling:</p>
<pre><code class="hljs">POST <span class="hljs-regexp">/wake-functions/</span>{functionName}
</code></pre>
<p>Each time:</p>
<ul>
<li>pending messages ‚â• threshold</li>
<li>OR recent activity detected</li>
</ul>
<hr>
<h2>üîÑ How SlimFaasKafka decides to wake up a function</h2>
<p>SlimFaasKafka evaluates each <em>binding</em> (topic + consumer group + function) by computing:</p>
<h3>1. Pending messages</h3>
<p>Based on:</p>
<pre><code class="hljs"><span class="hljs-attr">pending</span> = high_watermark - committed_<span class="hljs-literal">off</span>set
</code></pre>
<p>If AdminClient (ACL) doesn‚Äôt allow offset read, fallback uses:</p>
<pre><code class="hljs"><span class="hljs-attribute">pending</span> <span class="hljs-operator">=</span> high_watermarks
</code></pre>
<p><em>(less accurate but safe)</em></p>
<h3>2. Recent activity</h3>
<p>SlimFaasKafka tracks changes in committed offsets.
If offsets increase, it means a consumer worked recently.</p>
<p>You can configure:</p>
<ul>
<li><strong>minimum delta</strong> that qualifies as activity</li>
<li><strong>activity keep‚Äëalive window</strong> to keep the function awake after processing messages</li>
</ul>
<h3>3. Cooldown</h3>
<p>To avoid spamming SlimFaas, a wake‚Äëup cooldown per (topic, group) is applied.</p>
<hr>
<h2>üß© Bindings</h2>
<p>A binding describes:</p>
<ul>
<li>which Kafka topic to monitor</li>
<li>which consumer group represents the function‚Äôs consumption</li>
<li>which SlimFaas function should be woken up</li>
</ul>
<p>Example binding:</p>
<pre><code class="language-json hljs"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Topic"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fibo-public"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"ConsumerGroupId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fibonacci-listener-group"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"FunctionName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fibonaccilistener"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"MinPendingMessages"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"CooldownSeconds"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"ActivityKeepAliveSeconds"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">60</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"MinConsumedDeltaForActivity"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr>
<h2>‚öôÔ∏è Configuration (Environment Variables)</h2>
<p>SlimFaasKafka uses three configuration sections:</p>
<hr>
<h3>1. <strong>Kafka Settings</strong></h3>
<div class="table-scroll" role="region" aria-label="Scrollable table" tabindex="0"><table>
<thead>
<tr>
<th>Env Var</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Kafka__BootstrapServers</code></td>
<td>e.g. <code>kafka:9092</code>. MUST NOT be <code>localhost</code> inside Docker.</td>
</tr>
<tr>
<td><code>Kafka__ClientId</code></td>
<td>Name sent to Kafka broker</td>
</tr>
<tr>
<td><code>Kafka__CheckIntervalSeconds</code></td>
<td>How often to check queues</td>
</tr>
<tr>
<td><code>Kafka__KafkaTimeoutSeconds</code></td>
<td>Query timeout</td>
</tr>
<tr>
<td><code>Kafka__AllowAutoCreateTopics</code></td>
<td>Allow auto topic creation</td>
</tr>
</tbody>
</table></div>
<hr>
<h3>2. <strong>SlimFaas Settings</strong></h3>
<div class="table-scroll" role="region" aria-label="Scrollable table" tabindex="0"><table>
<thead>
<tr>
<th>Env Var</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SlimFaas__BaseUrl</code></td>
<td>URL of the SlimFaas API inside Docker (e.g. <code>http://slimfaas:30021</code>)</td>
</tr>
<tr>
<td><code>SlimFaas__WakeUpPathTemplate</code></td>
<td>Wake endpoint, default: <code>/functions/{functionName}/wake</code></td>
</tr>
<tr>
<td><code>SlimFaas__HttpTimeoutSeconds</code></td>
<td>HTTP timeout</td>
</tr>
</tbody>
</table></div>
<hr>
<h3>3. <strong>SlimFaasKafka Bindings</strong></h3>
<p>Each binding is configured through indexed env vars:</p>
<pre><code class="hljs"><span class="hljs-attr">SlimFaasKafka__Bindings__0__Topic</span>=fibo-public
<span class="hljs-attr">SlimFaasKafka__Bindings__0__ConsumerGroupId</span>=fibonacci-listener-group
<span class="hljs-attr">SlimFaasKafka__Bindings__0__FunctionName</span>=fibonaccilistener
<span class="hljs-attr">SlimFaasKafka__Bindings__0__MinPendingMessages</span>=<span class="hljs-number">1</span>
<span class="hljs-attr">SlimFaasKafka__Bindings__0__CooldownSeconds</span>=<span class="hljs-number">30</span>
<span class="hljs-attr">SlimFaasKafka__Bindings__0__ActivityKeepAliveSeconds</span>=<span class="hljs-number">60</span>
<span class="hljs-attr">SlimFaasKafka__Bindings__0__MinConsumedDeltaForActivity</span>=<span class="hljs-number">1</span>
</code></pre>
<p>You can add more bindings:</p>
<pre><code class="hljs"><span class="hljs-attribute">SlimFaasKafka__Bindings__1__Topic</span>=orders
<span class="hljs-attribute">SlimFaasKafka__Bindings__1__ConsumerGroupId</span>=orders-group
<span class="hljs-attribute">SlimFaasKafka__Bindings__1__FunctionName</span>=processorders
<span class="hljs-built_in">..</span>.
</code></pre>
<p>Description:</p>
<div class="table-scroll" role="region" aria-label="Scrollable table" tabindex="0"><table>
<thead>
<tr>
<th>Environment variable</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SlimFaasKafka__Bindings__0__Topic</code></td>
<td>string</td>
<td>‚Äì</td>
<td>Name of the <strong>Kafka topic</strong> to watch. SlimFaasKafka will inspect this topic to detect pending messages and activity.</td>
</tr>
<tr>
<td><code>SlimFaasKafka__Bindings__0__ConsumerGroupId</code></td>
<td>string</td>
<td>‚Äì</td>
<td><strong>Kafka consumer group</strong> to monitor for this topic. SlimFaasKafka looks at this group‚Äôs committed offsets to estimate lag and recent activity.</td>
</tr>
<tr>
<td><code>SlimFaasKafka__Bindings__0__FunctionName</code></td>
<td>string</td>
<td>‚Äì</td>
<td>Name of the <strong>SlimFaas function</strong> to wake up when conditions are met (pending messages and/or recent activity). This is the value used in the SlimFaas wake-up API.</td>
</tr>
<tr>
<td><code>SlimFaasKafka__Bindings__0__MinPendingMessages</code></td>
<td>int</td>
<td><code>1</code></td>
<td>Minimum number of <strong>pending messages</strong> (lag) required before triggering a wake-up based on backlog. If the lag is below this threshold, no wake-up is triggered for ‚Äúpending‚Äù reason.</td>
</tr>
<tr>
<td><code>SlimFaasKafka__Bindings__0__CooldownSeconds</code></td>
<td>int</td>
<td><code>30</code></td>
<td><strong>Cooldown</strong> between two wake-ups for this binding (topic + group + function). As long as the last wake-up is more recent than this delay, no new wake-up will be sent.</td>
</tr>
<tr>
<td><code>SlimFaasKafka__Bindings__0__ActivityKeepAliveSeconds</code></td>
<td>int</td>
<td><code>60</code></td>
<td>Duration during which a <strong>recent consumption activity</strong> (committed offsets increasing) keeps the function ‚Äúwarm‚Äù. If activity is detected within this window, SlimFaasKafka can trigger a wake-up even with low lag (reason = <code>activity</code>).</td>
</tr>
<tr>
<td><code>SlimFaasKafka__Bindings__0__MinConsumedDeltaForActivity</code></td>
<td>int</td>
<td><code>1</code></td>
<td>Minimum <strong>delta of committed messages</strong> (sum of offsets) to consider that ‚Äúreal‚Äù activity happened for the keep-alive logic. If the delta is below this value, the activity is ignored for the <code>activity</code> wake-up reason.</td>
</tr>
</tbody>
</table></div>
<hr>
<h2>üì° Metrics Endpoint</h2>
<p>SlimFaasKafka exposes Prometheus metrics at:</p>
<pre><code class="hljs">/metrics
</code></pre>
<p>Metrics include:</p>
<div class="table-scroll" role="region" aria-label="Scrollable table" tabindex="0"><table>
<thead>
<tr>
<th>Metric</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slimfaaskafka_wakeups_total</code></td>
<td>Number of wake-ups per binding</td>
</tr>
<tr>
<td><code>slimfaaskafka_pending_messages</code></td>
<td>Pending messages per topic/group/function</td>
</tr>
<tr>
<td><code>slimfaaskafka_last_activity_timestamp_seconds</code></td>
<td>Last activity time</td>
</tr>
</tbody>
</table></div>
<hr>
<h2>üìà Using Kafka metrics with SlimFaas Autoscaler (HPA-style)</h2>
<p>The metrics exported by <code>KafkaMonitoringWorker</code> can be used directly by the <strong>SlimFaas PromQL-based autoscaler</strong> (the HPA-like <code>SlimFaas/Scale</code> mechanism). Below are ready-to-use examples of PromQL queries that are compatible with the SlimFaas PromQL mini-evaluator and that you can plug into <code>SlimFaas/Scale.Triggers[].Query</code>.</p>
<blockquote>
<p>All examples assume that:</p>
<ul>
<li><code>slimfaaskafka_*</code> metrics are scraped by the SlimFaas metrics scraper,</li>
<li>the label <code>function</code> corresponds to the SlimFaas function name (usually <code>${app}</code> in your annotations).</li>
</ul>
</blockquote>
<h3>1. Scale out based on Kafka pending messages (queue length)</h3>
<p>Scale a function based on <strong>pending messages</strong> observed by SlimFaasKafka:</p>
<pre><code class="language-json hljs"><span class="hljs-params">annotations:</span>
  SlimFaas<span class="hljs-operator">/</span><span class="hljs-params">Scale:</span> <span class="hljs-operator">&gt;</span>
    {
      <span class="hljs-string">"ReplicaMax"</span>: <span class="hljs-number">50</span>,
      <span class="hljs-string">"Triggers"</span>: [
        {
          <span class="hljs-string">"MetricType"</span>: <span class="hljs-string">"Value"</span>,
          <span class="hljs-string">"MetricName"</span>: <span class="hljs-string">"kafka_pending_messages_max_30s"</span>,
          <span class="hljs-string">"Query"</span>: <span class="hljs-string">"max_over_time(slimfaaskafka_pending_messages{function=<span class="hljs-char escape_">\"</span><span class="hljs-subst">${app}</span><span class="hljs-char escape_">\"</span>}[30s])"</span>,
          <span class="hljs-string">"Threshold"</span>: <span class="hljs-number">200</span>
        }
      ]
    }
</code></pre>
<p><strong>How it works</strong></p>
<ul>
<li>PromQL: <code>max_over_time(slimfaaskafka_pending_messages{function="${app}"}[30s])</code>
<ul>
<li>Looks at the <strong>maximum</strong> pending messages for this function over the last 30 seconds.</li>
</ul>
</li>
<li><code>MetricType = "Value"</code>:
<ul>
<li>The threshold is interpreted as the <strong>total</strong> value we‚Äôre willing to accept.</li>
</ul>
</li>
<li><code>Threshold = 200</code>:
<ul>
<li>If the max pending messages in the last 30s is 400, the SlimFaas autoscaler will aim for roughly <code>2 √ó currentReplicas</code> (subject to policies and caps).</li>
</ul>
</li>
<li>This is ideal when you want to <strong>react to bursty Kafka queues</strong>.</li>
</ul>
<h3>2. Scale based on average pending messages (smooth queue pressure)</h3>
<p>If you prefer a smoother signal, you can use <code>avg_over_time</code>-like behavior by combining <code>avg()</code> and <code>max_over_time()</code>.
Because the current mini-evaluator does not support <code>avg_over_time</code>, a simple alternative is to evaluate the <strong>current</strong> pending messages and treat spikes implicitly through your scale-up policies:</p>
<pre><code class="language-json hljs"><span class="hljs-params">annotations:</span>
  SlimFaas<span class="hljs-operator">/</span><span class="hljs-params">Scale:</span> <span class="hljs-operator">&gt;</span>
    {
      <span class="hljs-string">"ReplicaMax"</span>: <span class="hljs-number">50</span>,
      <span class="hljs-string">"Triggers"</span>: [
        {
          <span class="hljs-string">"MetricType"</span>: <span class="hljs-string">"Value"</span>,
          <span class="hljs-string">"MetricName"</span>: <span class="hljs-string">"kafka_pending_messages_instant"</span>,
          <span class="hljs-string">"Query"</span>: <span class="hljs-string">"sum(slimfaaskafka_pending_messages{function=<span class="hljs-char escape_">\"</span><span class="hljs-subst">${app}</span><span class="hljs-char escape_">\"</span>})"</span>,
          <span class="hljs-string">"Threshold"</span>: <span class="hljs-number">100</span>
        }
      ]
    }
</code></pre>
<p><strong>How it works</strong></p>
<ul>
<li>PromQL: <code>sum(slimfaaskafka_pending_messages{function="${app}"})</code>
<ul>
<li>Sums all pending messages across bindings for this function.</li>
</ul>
</li>
<li><code>Threshold = 100</code>:
<ul>
<li>When the total pending messages grows above 100, the autoscaler increases the number of pods.</li>
</ul>
</li>
</ul>
<p>You can combine this with <strong>scale-up policies</strong> to react faster to sudden spikes:</p>
<pre><code class="language-json hljs"><span class="hljs-string">"Behavior"</span>: {
  <span class="hljs-string">"ScaleUp"</span>: {
    <span class="hljs-string">"StabilizationWindowSeconds"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">"Policies"</span>: [
      { <span class="hljs-string">"Type"</span>: <span class="hljs-string">"Percent"</span>, <span class="hljs-string">"Value"</span>: <span class="hljs-number">100</span>, <span class="hljs-string">"PeriodSeconds"</span>: <span class="hljs-number">15</span> },
      { <span class="hljs-string">"Type"</span>: <span class="hljs-string">"Pods"</span>,    <span class="hljs-string">"Value"</span>: <span class="hljs-number">10</span>,  <span class="hljs-string">"PeriodSeconds"</span>: <span class="hljs-number">15</span> }
    ]
  }
}
</code></pre>
<h3>3. Scale based on wake-up rate (wakeups per minute)</h3>
<p>You can also use the <strong>rate of wake-ups</strong> as a signal that your Kafka queues are frequently triggering function activity.</p>
<pre><code class="language-json hljs"><span class="hljs-params">annotations:</span>
  SlimFaas<span class="hljs-operator">/</span><span class="hljs-params">Scale:</span> <span class="hljs-operator">&gt;</span>
    {
      <span class="hljs-string">"ReplicaMax"</span>: <span class="hljs-number">20</span>,
      <span class="hljs-string">"Triggers"</span>: [
        {
          <span class="hljs-string">"MetricType"</span>: <span class="hljs-string">"Value"</span>,
          <span class="hljs-string">"MetricName"</span>: <span class="hljs-string">"kafka_wakeups_per_minute"</span>,
          <span class="hljs-string">"Query"</span>: <span class="hljs-string">"sum(rate(slimfaaskafka_wakeups_total{function=<span class="hljs-char escape_">\"</span><span class="hljs-subst">${app}</span><span class="hljs-char escape_">\"</span>}[1m]))"</span>,
          <span class="hljs-string">"Threshold"</span>: <span class="hljs-number">5</span>
        }
      ]
    }
</code></pre>
<p><strong>How it works</strong></p>
<ul>
<li>PromQL: <code>sum(rate(slimfaaskafka_wakeups_total{function="${app}"}[1m]))</code>
<ul>
<li>Estimates how many wake-ups per second occurred for this function over the last minute.</li>
<li>Since it‚Äôs a rate, <code>5</code> means ‚Äúaround 5 wake-ups per second‚Äù (you can choose smaller values if needed).</li>
</ul>
</li>
<li>Use this when:
<ul>
<li>You see <strong>frequent wake-up events</strong> and want SlimFaas to keep more pods around to avoid cold starts.</li>
</ul>
</li>
</ul>
<blockquote>
<p>Note: using wake-up rate alone can be noisy. It usually works best <strong>combined with pending messages</strong> or other metrics.</p>
</blockquote>
<h3>4. Combined trigger: pending messages + wake-up rate</h3>
<p>You can combine Kafka-queue pressure and wake-up frequency in a single <code>SlimFaas/Scale</code> config:</p>
<pre><code class="language-json hljs"><span class="hljs-params">annotations:</span>
  SlimFaas<span class="hljs-operator">/</span><span class="hljs-params">Scale:</span> <span class="hljs-operator">&gt;</span>
    {
      <span class="hljs-string">"ReplicaMax"</span>: <span class="hljs-number">50</span>,
      <span class="hljs-string">"Triggers"</span>: [
        {
          <span class="hljs-string">"MetricType"</span>: <span class="hljs-string">"Value"</span>,
          <span class="hljs-string">"MetricName"</span>: <span class="hljs-string">"kafka_pending_messages_max_30s"</span>,
          <span class="hljs-string">"Query"</span>: <span class="hljs-string">"max_over_time(slimfaaskafka_pending_messages{function=<span class="hljs-char escape_">\"</span><span class="hljs-subst">${app}</span><span class="hljs-char escape_">\"</span>}[30s])"</span>,
          <span class="hljs-string">"Threshold"</span>: <span class="hljs-number">200</span>
        },
        {
          <span class="hljs-string">"MetricType"</span>: <span class="hljs-string">"Value"</span>,
          <span class="hljs-string">"MetricName"</span>: <span class="hljs-string">"kafka_wakeups_per_minute"</span>,
          <span class="hljs-string">"Query"</span>: <span class="hljs-string">"sum(rate(slimfaaskafka_wakeups_total{function=<span class="hljs-char escape_">\"</span><span class="hljs-subst">${app}</span><span class="hljs-char escape_">\"</span>}[1m]))"</span>,
          <span class="hljs-string">"Threshold"</span>: <span class="hljs-number">2</span>
        }
      ],
      <span class="hljs-string">"Behavior"</span>: {
        <span class="hljs-string">"ScaleUp"</span>: {
          <span class="hljs-string">"StabilizationWindowSeconds"</span>: <span class="hljs-number">0</span>,
          <span class="hljs-string">"Policies"</span>: [
            { <span class="hljs-string">"Type"</span>: <span class="hljs-string">"Percent"</span>, <span class="hljs-string">"Value"</span>: <span class="hljs-number">100</span>, <span class="hljs-string">"PeriodSeconds"</span>: <span class="hljs-number">15</span> },
            { <span class="hljs-string">"Type"</span>: <span class="hljs-string">"Pods"</span>,    <span class="hljs-string">"Value"</span>: <span class="hljs-number">10</span>,  <span class="hljs-string">"PeriodSeconds"</span>: <span class="hljs-number">15</span> }
          ]
        },
        <span class="hljs-string">"ScaleDown"</span>: {
          <span class="hljs-string">"StabilizationWindowSeconds"</span>: <span class="hljs-number">300</span>,
          <span class="hljs-string">"Policies"</span>: [
            { <span class="hljs-string">"Type"</span>: <span class="hljs-string">"Percent"</span>, <span class="hljs-string">"Value"</span>: <span class="hljs-number">50</span>, <span class="hljs-string">"PeriodSeconds"</span>: <span class="hljs-number">30</span> }
          ]
        }
      }
    }
</code></pre>
<p><strong>Behavior</strong></p>
<ul>
<li>The autoscaler computes a desired replica count for <strong>each trigger</strong>.</li>
<li>The final <code>desiredReplicas</code> is the <strong>maximum</strong> of:
<ul>
<li>the desired from pending messages,</li>
<li>the desired from wake-up rate.</li>
</ul>
</li>
<li>Scale-up is fast (aggressive policies), scale-down is more conservative (stabilization window + softer policies).</li>
</ul>
<hr>
<h2>üê≥ Running with Docker Compose</h2>
<p>Minimal example:</p>
<pre><code class="language-yaml hljs">slimkafka:
    build:
        context: ./src/SlimFaasKafka
        dockerfile: Dockerfile
    environment:
        - <span class="hljs-attribute">Kafka__BootstrapServers</span>=kafka:9092
        - <span class="hljs-attribute">Kafka__CheckIntervalSeconds</span>=5
        - <span class="hljs-attribute">SlimFaas__BaseUrl</span>=http://slimfaas:30021
        - <span class="hljs-attribute">SlimKafka__Bindings__0__Topic</span>=fibo-public
        - <span class="hljs-attribute">SlimKafka__Bindings__0__ConsumerGroupId</span>=fibonacci-listener-group
        - <span class="hljs-attribute">SlimKafka__Bindings__0__FunctionName</span>=fibonaccilistener
        - <span class="hljs-attribute">SlimKafka__Bindings__0__MinPendingMessages</span>=1
        - <span class="hljs-attribute">SlimKafka__Bindings__0__CooldownSeconds</span>=30
        - <span class="hljs-attribute">SlimKafka__Bindings__0__ActivityKeepAliveSeconds</span>=60
        - <span class="hljs-attribute">SlimKafka__Bindings__0__MinConsumedDeltaForActivity</span>=1
    networks:
        - slimfaas-net
</code></pre>
<p>Make sure:</p>
<ul>
<li>SlimFaas and SlimFaasKafka are on the same Docker network</li>
<li>Kafka‚Äôs <code>ADVERTISED_LISTENERS</code> does <em>not</em> include <code>localhost</code></li>
<li>SlimFaas is reachable at the internal hostname (<code>slimfaas:30021</code>)</li>
</ul>
<hr>
<h2>üö¶ Startup Sequence</h2>
<ol>
<li>Kafka starts</li>
<li>SlimFaas starts</li>
<li>SlimFaasKafka starts</li>
<li>SlimFaasKafka connects to Kafka</li>
<li>SlimFaasKafka monitors the configured topics</li>
<li>If messages arrive ‚Üí SlimFaasKafka calls SlimFaas ‚Üí SlimFaas scales function up</li>
</ol>
<hr>
<h2>‚úî Summary</h2>
<p>SlimFaasKafka enables:</p>
<ul>
<li><strong>Zero‚Äëto‚ÄëN autoscaling</strong> for Kafka-driven functions</li>
<li>Without consuming messages</li>
<li>With monitoring of lag and recent activity</li>
<li>Full Prometheus visibility</li>
<li>Easy configuration through environment variables</li>
<li>Works perfectly inside Docker or Kubernetes</li>
</ul>
<p>It is the recommended companion service for <strong>event-driven SlimFaas workloads</strong>.</p>
</body></html></div></div></main><footer class="footer"><div class="footer__container"><p class="footer__origin">SlimFaas was originally created by AXA France.</p><div class="footer__cncf"><p class="footer__cncf-text">We are a Cloud Native Computing Foundation sandbox project.</p><img alt="CNCF Logo" loading="lazy" width="150" height="150" decoding="async" data-nimg="1" class="footer__cncf-logo" style="color:transparent" src="https://www.cncf.io/wp-content/uploads/2022/07/cncf-stacked-color-bg.svg"/></div><p class="footer__kubecon">Learn more about us at <a href="https://events.linuxfoundation.org/kubecon-cloudnativecon/" class="footer__kubecon-link">KubeCon + CloudNativeCon</a>.</p><p class="footer__trademark">The Linux Foundation¬Æ (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href="https://www.linuxfoundation.org/trademark-usage" class="footer__trademark-link">Trademark Usage</a>.</p><p class="footer__copyright">¬© SlimFaas a Series of LF Projects, LLC. All rights reserved. ¬†|¬†<a href="#" class="footer__trademark-link">Cookie settings</a></p></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"contentHtml":"\u003chtml\u003e\u003chead\u003e\u003c/head\u003e\u003cbody\u003e\u003ch1\u003eSlimFaas Kafka Connector \u003ca href=\"https://hub.docker.com/r/axaguildev/slimfaas-kafka/builds\"\u003e\u003cimg src=\"https://img.shields.io/docker/pulls/axaguildev/slimfaas-kafka.svg?label=docker+pull+slimfaas-kafka\" alt=\"Docker SlimFaas\"\u003e\u003c/a\u003e \u003ca href=\"https://hub.docker.com/r/axaguildev/slimfaas/builds\"\u003e\u003cimg src=\"https://img.shields.io/docker/image-size/axaguildev/slimfaas-kafka?label=image+size+slimfaas-kafka\" alt=\"Docker Image Size\"\u003e\u003c/a\u003e \u003ca href=\"https://hub.docker.com/r/axaguildev/slimfaas-kafka/builds\"\u003e\u003cimg src=\"https://img.shields.io/docker/v/axaguildev/slimfaas-kafka?sort=semver\u0026amp;label=latest+version+slimfaas-kafka\" alt=\"Docker Image Version\"\u003e\u003c/a\u003e \u003ca href=\"https://artifacthub.io/packages/search?repo=slimfaas-kafka\"\u003e\u003cimg src=\"https://img.shields.io/endpoint?url=https://artifacthub.io/badge/repository/slimfaas-kafka\" alt=\"Artifact Hub\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eSlimFaas-Kafka is a lightweight micro‚Äëservice designed to \u003cstrong\u003emonitor Kafka topics\u003c/strong\u003e and automatically \u003cstrong\u003ewake up SlimFaas functions\u003c/strong\u003e when messages arrive or when recent Kafka activity indicates the function should stay awake.\nIt enables full event‚Äëdriven autoscaling of SlimFaas functions based on Kafka queues ‚Äî without consuming the messages itself.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003eüöÄ Overview\u003c/h2\u003e\n\u003cp\u003eSlimFaas-Kafka acts as a \u003cstrong\u003esidecar orchestration component\u003c/strong\u003e that:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eWatches Kafka topics\u003c/strong\u003e for:\n\u003cul\u003e\n\u003cli\u003ePending messages (lag)\u003c/li\u003e\n\u003cli\u003eRecent consumption activity (progress in committed offsets)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eDecides when a SlimFaas function should be started or kept alive\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eTriggers SlimFaas wake‚Äëup API\u003c/strong\u003e to scale functions from 0 ‚Üí N pods\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eSlimFaasKafka \u003cstrong\u003enever consumes messages\u003c/strong\u003e from your topics.\nIt only queries:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ehigh watermark offsets (latest message index per partition)\u003c/li\u003e\n\u003cli\u003ecommitted consumer group offsets (only if Kafka ACLs allow it)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThis means your message streams remain \u003cstrong\u003euntouched\u003c/strong\u003e and your existing consumers operate normally.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003eüèó Architecture\u003c/h2\u003e\n\u003cp\u003eBelow is the logical architecture:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs\"\u003eKafka Topics  ‚Üí  SlimFaasKafka  ‚Üí  SlimFaas Orchestrator  ‚Üí  \u003cspan class=\"hljs-keyword\"\u003eFunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePods\u003c/span\u003e\n                    ‚Üë   ‚Üì                         ‚Üë\n       Metadata \u0026amp; Offsets   Wake‚Äëup events        |\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eComponents\u003c/h3\u003e\n\u003cdiv class=\"table-scroll\" role=\"region\" aria-label=\"Scrollable table\" tabindex=\"0\"\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eComponent\u003c/th\u003e\n\u003cth\u003eDescription\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eSlimFaasKafka\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003eMonitors Kafka lag \u0026amp; activity; sends wake signals\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eKafka Broker\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003eHolds the messages and consumer groups\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eSlimFaas\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003eManages function replicas and performs the actual autoscaling\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003cstrong\u003eFunction Pods\u003c/strong\u003e\u003c/td\u003e\n\u003ctd\u003eStateless workers that process Kafka messages\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\u003c/div\u003e\n\u003cp\u003eSlimFaasKafka integrates with SlimFaas by calling:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs\"\u003ePOST \u003cspan class=\"hljs-regexp\"\u003e/wake-functions/\u003c/span\u003e{functionName}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eEach time:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003epending messages ‚â• threshold\u003c/li\u003e\n\u003cli\u003eOR recent activity detected\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2\u003eüîÑ How SlimFaasKafka decides to wake up a function\u003c/h2\u003e\n\u003cp\u003eSlimFaasKafka evaluates each \u003cem\u003ebinding\u003c/em\u003e (topic + consumer group + function) by computing:\u003c/p\u003e\n\u003ch3\u003e1. Pending messages\u003c/h3\u003e\n\u003cp\u003eBased on:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-attr\"\u003epending\u003c/span\u003e = high_watermark - committed_\u003cspan class=\"hljs-literal\"\u003eoff\u003c/span\u003eset\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf AdminClient (ACL) doesn‚Äôt allow offset read, fallback uses:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-attribute\"\u003epending\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e=\u003c/span\u003e high_watermarks\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cem\u003e(less accurate but safe)\u003c/em\u003e\u003c/p\u003e\n\u003ch3\u003e2. Recent activity\u003c/h3\u003e\n\u003cp\u003eSlimFaasKafka tracks changes in committed offsets.\nIf offsets increase, it means a consumer worked recently.\u003c/p\u003e\n\u003cp\u003eYou can configure:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eminimum delta\u003c/strong\u003e that qualifies as activity\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eactivity keep‚Äëalive window\u003c/strong\u003e to keep the function awake after processing messages\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e3. Cooldown\u003c/h3\u003e\n\u003cp\u003eTo avoid spamming SlimFaas, a wake‚Äëup cooldown per (topic, group) is applied.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2\u003eüß© Bindings\u003c/h2\u003e\n\u003cp\u003eA binding describes:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ewhich Kafka topic to monitor\u003c/li\u003e\n\u003cli\u003ewhich consumer group represents the function‚Äôs consumption\u003c/li\u003e\n\u003cli\u003ewhich SlimFaas function should be woken up\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eExample binding:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json hljs\"\u003e\u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"Topic\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"fibo-public\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"ConsumerGroupId\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"fibonacci-listener-group\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"FunctionName\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"fibonaccilistener\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"MinPendingMessages\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"CooldownSeconds\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"ActivityKeepAliveSeconds\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\"MinConsumedDeltaForActivity\"\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003chr\u003e\n\u003ch2\u003e‚öôÔ∏è Configuration (Environment Variables)\u003c/h2\u003e\n\u003cp\u003eSlimFaasKafka uses three configuration sections:\u003c/p\u003e\n\u003chr\u003e\n\u003ch3\u003e1. \u003cstrong\u003eKafka Settings\u003c/strong\u003e\u003c/h3\u003e\n\u003cdiv class=\"table-scroll\" role=\"region\" aria-label=\"Scrollable table\" tabindex=\"0\"\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eEnv Var\u003c/th\u003e\n\u003cth\u003eMeaning\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eKafka__BootstrapServers\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003ee.g. \u003ccode\u003ekafka:9092\u003c/code\u003e. MUST NOT be \u003ccode\u003elocalhost\u003c/code\u003e inside Docker.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eKafka__ClientId\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eName sent to Kafka broker\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eKafka__CheckIntervalSeconds\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eHow often to check queues\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eKafka__KafkaTimeoutSeconds\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eQuery timeout\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eKafka__AllowAutoCreateTopics\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eAllow auto topic creation\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\u003c/div\u003e\n\u003chr\u003e\n\u003ch3\u003e2. \u003cstrong\u003eSlimFaas Settings\u003c/strong\u003e\u003c/h3\u003e\n\u003cdiv class=\"table-scroll\" role=\"region\" aria-label=\"Scrollable table\" tabindex=\"0\"\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eEnv Var\u003c/th\u003e\n\u003cth\u003eMeaning\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eSlimFaas__BaseUrl\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eURL of the SlimFaas API inside Docker (e.g. \u003ccode\u003ehttp://slimfaas:30021\u003c/code\u003e)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eSlimFaas__WakeUpPathTemplate\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eWake endpoint, default: \u003ccode\u003e/functions/{functionName}/wake\u003c/code\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eSlimFaas__HttpTimeoutSeconds\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eHTTP timeout\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\u003c/div\u003e\n\u003chr\u003e\n\u003ch3\u003e3. \u003cstrong\u003eSlimFaasKafka Bindings\u003c/strong\u003e\u003c/h3\u003e\n\u003cp\u003eEach binding is configured through indexed env vars:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-attr\"\u003eSlimFaasKafka__Bindings__0__Topic\u003c/span\u003e=fibo-public\n\u003cspan class=\"hljs-attr\"\u003eSlimFaasKafka__Bindings__0__ConsumerGroupId\u003c/span\u003e=fibonacci-listener-group\n\u003cspan class=\"hljs-attr\"\u003eSlimFaasKafka__Bindings__0__FunctionName\u003c/span\u003e=fibonaccilistener\n\u003cspan class=\"hljs-attr\"\u003eSlimFaasKafka__Bindings__0__MinPendingMessages\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eSlimFaasKafka__Bindings__0__CooldownSeconds\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eSlimFaasKafka__Bindings__0__ActivityKeepAliveSeconds\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e60\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eSlimFaasKafka__Bindings__0__MinConsumedDeltaForActivity\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou can add more bindings:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs\"\u003e\u003cspan class=\"hljs-attribute\"\u003eSlimFaasKafka__Bindings__1__Topic\u003c/span\u003e=orders\n\u003cspan class=\"hljs-attribute\"\u003eSlimFaasKafka__Bindings__1__ConsumerGroupId\u003c/span\u003e=orders-group\n\u003cspan class=\"hljs-attribute\"\u003eSlimFaasKafka__Bindings__1__FunctionName\u003c/span\u003e=processorders\n\u003cspan class=\"hljs-built_in\"\u003e..\u003c/span\u003e.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDescription:\u003c/p\u003e\n\u003cdiv class=\"table-scroll\" role=\"region\" aria-label=\"Scrollable table\" tabindex=\"0\"\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eEnvironment variable\u003c/th\u003e\n\u003cth\u003eType\u003c/th\u003e\n\u003cth\u003eDefault\u003c/th\u003e\n\u003cth\u003eDescription\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eSlimFaasKafka__Bindings__0__Topic\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e‚Äì\u003c/td\u003e\n\u003ctd\u003eName of the \u003cstrong\u003eKafka topic\u003c/strong\u003e to watch. SlimFaasKafka will inspect this topic to detect pending messages and activity.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eSlimFaasKafka__Bindings__0__ConsumerGroupId\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e‚Äì\u003c/td\u003e\n\u003ctd\u003e\u003cstrong\u003eKafka consumer group\u003c/strong\u003e to monitor for this topic. SlimFaasKafka looks at this group‚Äôs committed offsets to estimate lag and recent activity.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eSlimFaasKafka__Bindings__0__FunctionName\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003estring\u003c/td\u003e\n\u003ctd\u003e‚Äì\u003c/td\u003e\n\u003ctd\u003eName of the \u003cstrong\u003eSlimFaas function\u003c/strong\u003e to wake up when conditions are met (pending messages and/or recent activity). This is the value used in the SlimFaas wake-up API.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eSlimFaasKafka__Bindings__0__MinPendingMessages\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eint\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e1\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eMinimum number of \u003cstrong\u003epending messages\u003c/strong\u003e (lag) required before triggering a wake-up based on backlog. If the lag is below this threshold, no wake-up is triggered for ‚Äúpending‚Äù reason.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eSlimFaasKafka__Bindings__0__CooldownSeconds\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eint\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e30\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003e\u003cstrong\u003eCooldown\u003c/strong\u003e between two wake-ups for this binding (topic + group + function). As long as the last wake-up is more recent than this delay, no new wake-up will be sent.\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eSlimFaasKafka__Bindings__0__ActivityKeepAliveSeconds\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eint\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e60\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eDuration during which a \u003cstrong\u003erecent consumption activity\u003c/strong\u003e (committed offsets increasing) keeps the function ‚Äúwarm‚Äù. If activity is detected within this window, SlimFaasKafka can trigger a wake-up even with low lag (reason = \u003ccode\u003eactivity\u003c/code\u003e).\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eSlimFaasKafka__Bindings__0__MinConsumedDeltaForActivity\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eint\u003c/td\u003e\n\u003ctd\u003e\u003ccode\u003e1\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eMinimum \u003cstrong\u003edelta of committed messages\u003c/strong\u003e (sum of offsets) to consider that ‚Äúreal‚Äù activity happened for the keep-alive logic. If the delta is below this value, the activity is ignored for the \u003ccode\u003eactivity\u003c/code\u003e wake-up reason.\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\u003c/div\u003e\n\u003chr\u003e\n\u003ch2\u003eüì° Metrics Endpoint\u003c/h2\u003e\n\u003cp\u003eSlimFaasKafka exposes Prometheus metrics at:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs\"\u003e/metrics\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMetrics include:\u003c/p\u003e\n\u003cdiv class=\"table-scroll\" role=\"region\" aria-label=\"Scrollable table\" tabindex=\"0\"\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eMetric\u003c/th\u003e\n\u003cth\u003eMeaning\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eslimfaaskafka_wakeups_total\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eNumber of wake-ups per binding\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eslimfaaskafka_pending_messages\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003ePending messages per topic/group/function\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003ccode\u003eslimfaaskafka_last_activity_timestamp_seconds\u003c/code\u003e\u003c/td\u003e\n\u003ctd\u003eLast activity time\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\u003c/div\u003e\n\u003chr\u003e\n\u003ch2\u003eüìà Using Kafka metrics with SlimFaas Autoscaler (HPA-style)\u003c/h2\u003e\n\u003cp\u003eThe metrics exported by \u003ccode\u003eKafkaMonitoringWorker\u003c/code\u003e can be used directly by the \u003cstrong\u003eSlimFaas PromQL-based autoscaler\u003c/strong\u003e (the HPA-like \u003ccode\u003eSlimFaas/Scale\u003c/code\u003e mechanism). Below are ready-to-use examples of PromQL queries that are compatible with the SlimFaas PromQL mini-evaluator and that you can plug into \u003ccode\u003eSlimFaas/Scale.Triggers[].Query\u003c/code\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAll examples assume that:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eslimfaaskafka_*\u003c/code\u003e metrics are scraped by the SlimFaas metrics scraper,\u003c/li\u003e\n\u003cli\u003ethe label \u003ccode\u003efunction\u003c/code\u003e corresponds to the SlimFaas function name (usually \u003ccode\u003e${app}\u003c/code\u003e in your annotations).\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003ch3\u003e1. Scale out based on Kafka pending messages (queue length)\u003c/h3\u003e\n\u003cp\u003eScale a function based on \u003cstrong\u003epending messages\u003c/strong\u003e observed by SlimFaasKafka:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json hljs\"\u003e\u003cspan class=\"hljs-params\"\u003eannotations:\u003c/span\u003e\n  SlimFaas\u003cspan class=\"hljs-operator\"\u003e/\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003eScale:\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e\u0026gt;\u003c/span\u003e\n    {\n      \u003cspan class=\"hljs-string\"\u003e\"ReplicaMax\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Triggers\"\u003c/span\u003e: [\n        {\n          \u003cspan class=\"hljs-string\"\u003e\"MetricType\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Value\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"MetricName\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"kafka_pending_messages_max_30s\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"max_over_time(slimfaaskafka_pending_messages{function=\u003cspan class=\"hljs-char escape_\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"hljs-subst\"\u003e${app}\u003c/span\u003e\u003cspan class=\"hljs-char escape_\"\u003e\\\"\u003c/span\u003e}[30s])\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Threshold\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n        }\n      ]\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eHow it works\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePromQL: \u003ccode\u003emax_over_time(slimfaaskafka_pending_messages{function=\"${app}\"}[30s])\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eLooks at the \u003cstrong\u003emaximum\u003c/strong\u003e pending messages for this function over the last 30 seconds.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eMetricType = \"Value\"\u003c/code\u003e:\n\u003cul\u003e\n\u003cli\u003eThe threshold is interpreted as the \u003cstrong\u003etotal\u003c/strong\u003e value we‚Äôre willing to accept.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eThreshold = 200\u003c/code\u003e:\n\u003cul\u003e\n\u003cli\u003eIf the max pending messages in the last 30s is 400, the SlimFaas autoscaler will aim for roughly \u003ccode\u003e2 √ó currentReplicas\u003c/code\u003e (subject to policies and caps).\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eThis is ideal when you want to \u003cstrong\u003ereact to bursty Kafka queues\u003c/strong\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e2. Scale based on average pending messages (smooth queue pressure)\u003c/h3\u003e\n\u003cp\u003eIf you prefer a smoother signal, you can use \u003ccode\u003eavg_over_time\u003c/code\u003e-like behavior by combining \u003ccode\u003eavg()\u003c/code\u003e and \u003ccode\u003emax_over_time()\u003c/code\u003e.\nBecause the current mini-evaluator does not support \u003ccode\u003eavg_over_time\u003c/code\u003e, a simple alternative is to evaluate the \u003cstrong\u003ecurrent\u003c/strong\u003e pending messages and treat spikes implicitly through your scale-up policies:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json hljs\"\u003e\u003cspan class=\"hljs-params\"\u003eannotations:\u003c/span\u003e\n  SlimFaas\u003cspan class=\"hljs-operator\"\u003e/\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003eScale:\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e\u0026gt;\u003c/span\u003e\n    {\n      \u003cspan class=\"hljs-string\"\u003e\"ReplicaMax\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Triggers\"\u003c/span\u003e: [\n        {\n          \u003cspan class=\"hljs-string\"\u003e\"MetricType\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Value\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"MetricName\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"kafka_pending_messages_instant\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"sum(slimfaaskafka_pending_messages{function=\u003cspan class=\"hljs-char escape_\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"hljs-subst\"\u003e${app}\u003c/span\u003e\u003cspan class=\"hljs-char escape_\"\u003e\\\"\u003c/span\u003e})\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Threshold\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e\n        }\n      ]\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eHow it works\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePromQL: \u003ccode\u003esum(slimfaaskafka_pending_messages{function=\"${app}\"})\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eSums all pending messages across bindings for this function.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eThreshold = 100\u003c/code\u003e:\n\u003cul\u003e\n\u003cli\u003eWhen the total pending messages grows above 100, the autoscaler increases the number of pods.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eYou can combine this with \u003cstrong\u003escale-up policies\u003c/strong\u003e to react faster to sudden spikes:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json hljs\"\u003e\u003cspan class=\"hljs-string\"\u003e\"Behavior\"\u003c/span\u003e: {\n  \u003cspan class=\"hljs-string\"\u003e\"ScaleUp\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\"StabilizationWindowSeconds\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e\"Policies\"\u003c/span\u003e: [\n      { \u003cspan class=\"hljs-string\"\u003e\"Type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Percent\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Value\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"PeriodSeconds\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e },\n      { \u003cspan class=\"hljs-string\"\u003e\"Type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Pods\"\u003c/span\u003e,    \u003cspan class=\"hljs-string\"\u003e\"Value\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e,  \u003cspan class=\"hljs-string\"\u003e\"PeriodSeconds\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e }\n    ]\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e3. Scale based on wake-up rate (wakeups per minute)\u003c/h3\u003e\n\u003cp\u003eYou can also use the \u003cstrong\u003erate of wake-ups\u003c/strong\u003e as a signal that your Kafka queues are frequently triggering function activity.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json hljs\"\u003e\u003cspan class=\"hljs-params\"\u003eannotations:\u003c/span\u003e\n  SlimFaas\u003cspan class=\"hljs-operator\"\u003e/\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003eScale:\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e\u0026gt;\u003c/span\u003e\n    {\n      \u003cspan class=\"hljs-string\"\u003e\"ReplicaMax\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Triggers\"\u003c/span\u003e: [\n        {\n          \u003cspan class=\"hljs-string\"\u003e\"MetricType\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Value\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"MetricName\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"kafka_wakeups_per_minute\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"sum(rate(slimfaaskafka_wakeups_total{function=\u003cspan class=\"hljs-char escape_\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"hljs-subst\"\u003e${app}\u003c/span\u003e\u003cspan class=\"hljs-char escape_\"\u003e\\\"\u003c/span\u003e}[1m]))\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Threshold\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e\n        }\n      ]\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eHow it works\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePromQL: \u003ccode\u003esum(rate(slimfaaskafka_wakeups_total{function=\"${app}\"}[1m]))\u003c/code\u003e\n\u003cul\u003e\n\u003cli\u003eEstimates how many wake-ups per second occurred for this function over the last minute.\u003c/li\u003e\n\u003cli\u003eSince it‚Äôs a rate, \u003ccode\u003e5\u003c/code\u003e means ‚Äúaround 5 wake-ups per second‚Äù (you can choose smaller values if needed).\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUse this when:\n\u003cul\u003e\n\u003cli\u003eYou see \u003cstrong\u003efrequent wake-up events\u003c/strong\u003e and want SlimFaas to keep more pods around to avoid cold starts.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote: using wake-up rate alone can be noisy. It usually works best \u003cstrong\u003ecombined with pending messages\u003c/strong\u003e or other metrics.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3\u003e4. Combined trigger: pending messages + wake-up rate\u003c/h3\u003e\n\u003cp\u003eYou can combine Kafka-queue pressure and wake-up frequency in a single \u003ccode\u003eSlimFaas/Scale\u003c/code\u003e config:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json hljs\"\u003e\u003cspan class=\"hljs-params\"\u003eannotations:\u003c/span\u003e\n  SlimFaas\u003cspan class=\"hljs-operator\"\u003e/\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003eScale:\u003c/span\u003e \u003cspan class=\"hljs-operator\"\u003e\u0026gt;\u003c/span\u003e\n    {\n      \u003cspan class=\"hljs-string\"\u003e\"ReplicaMax\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e,\n      \u003cspan class=\"hljs-string\"\u003e\"Triggers\"\u003c/span\u003e: [\n        {\n          \u003cspan class=\"hljs-string\"\u003e\"MetricType\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Value\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"MetricName\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"kafka_pending_messages_max_30s\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"max_over_time(slimfaaskafka_pending_messages{function=\u003cspan class=\"hljs-char escape_\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"hljs-subst\"\u003e${app}\u003c/span\u003e\u003cspan class=\"hljs-char escape_\"\u003e\\\"\u003c/span\u003e}[30s])\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Threshold\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e\n        },\n        {\n          \u003cspan class=\"hljs-string\"\u003e\"MetricType\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Value\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"MetricName\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"kafka_wakeups_per_minute\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Query\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"sum(rate(slimfaaskafka_wakeups_total{function=\u003cspan class=\"hljs-char escape_\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"hljs-subst\"\u003e${app}\u003c/span\u003e\u003cspan class=\"hljs-char escape_\"\u003e\\\"\u003c/span\u003e}[1m]))\"\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Threshold\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n        }\n      ],\n      \u003cspan class=\"hljs-string\"\u003e\"Behavior\"\u003c/span\u003e: {\n        \u003cspan class=\"hljs-string\"\u003e\"ScaleUp\"\u003c/span\u003e: {\n          \u003cspan class=\"hljs-string\"\u003e\"StabilizationWindowSeconds\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Policies\"\u003c/span\u003e: [\n            { \u003cspan class=\"hljs-string\"\u003e\"Type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Percent\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Value\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"PeriodSeconds\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e },\n            { \u003cspan class=\"hljs-string\"\u003e\"Type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Pods\"\u003c/span\u003e,    \u003cspan class=\"hljs-string\"\u003e\"Value\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e,  \u003cspan class=\"hljs-string\"\u003e\"PeriodSeconds\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e }\n          ]\n        },\n        \u003cspan class=\"hljs-string\"\u003e\"ScaleDown\"\u003c/span\u003e: {\n          \u003cspan class=\"hljs-string\"\u003e\"StabilizationWindowSeconds\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e300\u003c/span\u003e,\n          \u003cspan class=\"hljs-string\"\u003e\"Policies\"\u003c/span\u003e: [\n            { \u003cspan class=\"hljs-string\"\u003e\"Type\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"Percent\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"Value\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e50\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"PeriodSeconds\"\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e }\n          ]\n        }\n      }\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eBehavior\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe autoscaler computes a desired replica count for \u003cstrong\u003eeach trigger\u003c/strong\u003e.\u003c/li\u003e\n\u003cli\u003eThe final \u003ccode\u003edesiredReplicas\u003c/code\u003e is the \u003cstrong\u003emaximum\u003c/strong\u003e of:\n\u003cul\u003e\n\u003cli\u003ethe desired from pending messages,\u003c/li\u003e\n\u003cli\u003ethe desired from wake-up rate.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eScale-up is fast (aggressive policies), scale-down is more conservative (stabilization window + softer policies).\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2\u003eüê≥ Running with Docker Compose\u003c/h2\u003e\n\u003cp\u003eMinimal example:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml hljs\"\u003eslimkafka:\n    build:\n        context: ./src/SlimFaasKafka\n        dockerfile: Dockerfile\n    environment:\n        - \u003cspan class=\"hljs-attribute\"\u003eKafka__BootstrapServers\u003c/span\u003e=kafka:9092\n        - \u003cspan class=\"hljs-attribute\"\u003eKafka__CheckIntervalSeconds\u003c/span\u003e=5\n        - \u003cspan class=\"hljs-attribute\"\u003eSlimFaas__BaseUrl\u003c/span\u003e=http://slimfaas:30021\n        - \u003cspan class=\"hljs-attribute\"\u003eSlimKafka__Bindings__0__Topic\u003c/span\u003e=fibo-public\n        - \u003cspan class=\"hljs-attribute\"\u003eSlimKafka__Bindings__0__ConsumerGroupId\u003c/span\u003e=fibonacci-listener-group\n        - \u003cspan class=\"hljs-attribute\"\u003eSlimKafka__Bindings__0__FunctionName\u003c/span\u003e=fibonaccilistener\n        - \u003cspan class=\"hljs-attribute\"\u003eSlimKafka__Bindings__0__MinPendingMessages\u003c/span\u003e=1\n        - \u003cspan class=\"hljs-attribute\"\u003eSlimKafka__Bindings__0__CooldownSeconds\u003c/span\u003e=30\n        - \u003cspan class=\"hljs-attribute\"\u003eSlimKafka__Bindings__0__ActivityKeepAliveSeconds\u003c/span\u003e=60\n        - \u003cspan class=\"hljs-attribute\"\u003eSlimKafka__Bindings__0__MinConsumedDeltaForActivity\u003c/span\u003e=1\n    networks:\n        - slimfaas-net\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMake sure:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSlimFaas and SlimFaasKafka are on the same Docker network\u003c/li\u003e\n\u003cli\u003eKafka‚Äôs \u003ccode\u003eADVERTISED_LISTENERS\u003c/code\u003e does \u003cem\u003enot\u003c/em\u003e include \u003ccode\u003elocalhost\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eSlimFaas is reachable at the internal hostname (\u003ccode\u003eslimfaas:30021\u003c/code\u003e)\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2\u003eüö¶ Startup Sequence\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eKafka starts\u003c/li\u003e\n\u003cli\u003eSlimFaas starts\u003c/li\u003e\n\u003cli\u003eSlimFaasKafka starts\u003c/li\u003e\n\u003cli\u003eSlimFaasKafka connects to Kafka\u003c/li\u003e\n\u003cli\u003eSlimFaasKafka monitors the configured topics\u003c/li\u003e\n\u003cli\u003eIf messages arrive ‚Üí SlimFaasKafka calls SlimFaas ‚Üí SlimFaas scales function up\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch2\u003e‚úî Summary\u003c/h2\u003e\n\u003cp\u003eSlimFaasKafka enables:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eZero‚Äëto‚ÄëN autoscaling\u003c/strong\u003e for Kafka-driven functions\u003c/li\u003e\n\u003cli\u003eWithout consuming messages\u003c/li\u003e\n\u003cli\u003eWith monitoring of lag and recent activity\u003c/li\u003e\n\u003cli\u003eFull Prometheus visibility\u003c/li\u003e\n\u003cli\u003eEasy configuration through environment variables\u003c/li\u003e\n\u003cli\u003eWorks perfectly inside Docker or Kubernetes\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIt is the recommended companion service for \u003cstrong\u003eevent-driven SlimFaas workloads\u003c/strong\u003e.\u003c/p\u003e\n\u003c/body\u003e\u003c/html\u003e","metadata":{}},"__N_SSG":true},"page":"/kafka","query":{},"buildId":"d93zpedczAei54D1TFYtc","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>